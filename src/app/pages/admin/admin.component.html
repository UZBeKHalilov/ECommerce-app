<div class="min-h-screen bg-gray-900">
  <!-- Admin Header -->
  <header class="bg-gray-800 shadow-lg">
    <div class="container mx-auto px-4 py-4">
      <div class="flex items-center justify-between">
        <h1 class="text-2xl font-bold text-green-500">Admin Panel</h1>
        <div class="flex items-center space-x-4">
          <span class="text-gray-400">Welcome, Admin</span>
          <a routerLink="/" class="text-green-400 hover:text-green-300">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
            </svg>
          </a>
        </div>
      </div>
    </div>
  </header>

  <!-- Global Messages -->
  @if (successMessage) {
    <div class="bg-green-900 border border-green-700 text-white px-4 py-3 mx-4 mt-4 rounded relative">
      <span class="block sm:inline">{{ successMessage }}</span>
      <button 
        (click)="successMessage = null" 
        class="absolute top-0 bottom-0 right-0 px-4 py-3"
      >
        <span class="sr-only">Close</span>
        <span class="text-2xl">&times;</span>
      </button>
    </div>
  }

  @if (error) {
    <div class="bg-red-900 border border-red-700 text-white px-4 py-3 mx-4 mt-4 rounded relative">
      <span class="block sm:inline">{{ error }}</span>
      <button 
        (click)="error = null" 
        class="absolute top-0 bottom-0 right-0 px-4 py-3"
      >
        <span class="sr-only">Close</span>
        <span class="text-2xl">&times;</span>
      </button>
    </div>
  }

  <div class="flex">
    <!-- Sidebar Navigation -->
    <nav class="w-64 bg-gray-800 min-h-screen">
      <div class="p-4">
        <ul class="space-y-2">
          <li>
            <button 
              (click)="setActiveSection('dashboard')"
              class="w-full text-left px-4 py-3 rounded-lg transition-colors"
              [ngClass]="activeSection === 'dashboard' ? 'bg-green-600 text-white' : 'text-gray-400 hover:bg-gray-700 hover:text-white'"
            >
              <svg class="w-5 h-5 inline mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
              </svg>
              Dashboard
            </button>
          </li>
          <li>
            <button 
              (click)="setActiveSection('products')"
              class="w-full text-left px-4 py-3 rounded-lg transition-colors"
              [ngClass]="activeSection === 'products' ? 'bg-green-600 text-white' : 'text-gray-400 hover:bg-gray-700 hover:text-white'"
            >
              <svg class="w-5 h-5 inline mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path>
              </svg>
              Products
            </button>
          </li>
          <li>
            <button 
              (click)="setActiveSection('categories')"
              class="w-full text-left px-4 py-3 rounded-lg transition-colors"
              [ngClass]="activeSection === 'categories' ? 'bg-green-600 text-white' : 'text-gray-400 hover:bg-gray-700 hover:text-white'"
            >
              <svg class="w-5 h-5 inline mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
              </svg>
              Categories
            </button>
          </li>
          <li>
            <button 
              (click)="setActiveSection('orders')"
              class="w-full text-left px-4 py-3 rounded-lg transition-colors"
              [ngClass]="activeSection === 'orders' ? 'bg-green-600 text-white' : 'text-gray-400 hover:bg-gray-700 hover:text-white'"
            >
              <svg class="w-5 h-5 inline mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
              </svg>
              Orders
            </button>
          </li>
          <li>
            <button 
              (click)="setActiveSection('customers')"
              class="w-full text-left px-4 py-3 rounded-lg transition-colors"
              [ngClass]="activeSection === 'customers' ? 'bg-green-600 text-white' : 'text-gray-400 hover:bg-gray-700 hover:text-white'"
            >
              <svg class="w-5 h-5 inline mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"></path>
              </svg>
              Customers
            </button>
          </li>
          <li>
            <button 
              (click)="setActiveSection('users')"
              class="w-full text-left px-4 py-3 rounded-lg transition-colors"
              [ngClass]="activeSection === 'users' ? 'bg-green-600 text-white' : 'text-gray-400 hover:bg-gray-700 hover:text-white'"
            >
              <svg class="w-5 h-5 inline mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
              </svg>
              Users
            </button>
          </li>
        </ul>
      </div>
    </nav>

    <!-- Main Content -->
    <main class="flex-1 p-6">
      <!-- Dashboard Section -->
      @if (activeSection === 'dashboard') {
        <div>
          <h2 class="text-3xl font-bold mb-6 text-white">Dashboard Overview</h2>
          
          @if (isLoading) {
            <div class="flex justify-center items-center h-64">
              <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-green-500"></div>
            </div>
          }
          
          @if (stats && !isLoading) {
            <!-- Stats Cards -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
              <div class="bg-gray-800 rounded-lg p-6">
                <div class="flex items-center">
                  <div class="p-3 rounded-full bg-blue-500 bg-opacity-20">
                    <svg class="w-8 h-8 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path>
                    </svg>
                  </div>
                  <div class="ml-4">
                    <p class="text-sm font-medium text-gray-400">Total Products</p>
                    <p class="text-2xl font-semibold text-white">{{ stats.totalProducts }}</p>
                  </div>
                </div>
              </div>
              
              <div class="bg-gray-800 rounded-lg p-6">
                <div class="flex items-center">
                  <div class="p-3 rounded-full bg-green-500 bg-opacity-20">
                    <svg class="w-8 h-8 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                    </svg>
                  </div>
                  <div class="ml-4">
                    <p class="text-sm font-medium text-gray-400">Total Orders</p>
                    <p class="text-2xl font-semibold text-white">{{ stats.totalOrders }}</p>
                  </div>
                </div>
              </div>
              
              <div class="bg-gray-800 rounded-lg p-6">
                <div class="flex items-center">
                  <div class="p-3 rounded-full bg-purple-500 bg-opacity-20">
                    <svg class="w-8 h-8 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"></path>
                    </svg>
                  </div>
                  <div class="ml-4">
                    <p class="text-sm font-medium text-gray-400">Total Customers</p>
                    <p class="text-2xl font-semibold text-white">{{ stats.totalCustomers }}</p>
                  </div>
                </div>
              </div>
              
              <div class="bg-gray-800 rounded-lg p-6">
                <div class="flex items-center">
                  <div class="p-3 rounded-full bg-yellow-500 bg-opacity-20">
                    <svg class="w-8 h-8 text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
                    </svg>
                  </div>
                  <div class="ml-4">
                    <p class="text-sm font-medium text-gray-400">Total Revenue</p>
                    <p class="text-2xl font-semibold text-white">{{ formatCurrency(stats.totalRevenue) }}</p>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Additional Stats -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
              <div class="bg-gray-800 rounded-lg p-6">
                <h3 class="text-lg font-semibold text-green-400 mb-2">Pending Orders</h3>
                <p class="text-3xl font-bold text-white">{{ stats.pendingOrders }}</p>
                <p class="text-sm text-gray-400 mt-1">Require attention</p>
              </div>
              
              <div class="bg-gray-800 rounded-lg p-6">
                <h3 class="text-lg font-semibold text-green-400 mb-2">Low Stock Products</h3>
                <p class="text-3xl font-bold text-white">{{ stats.lowStockProducts }}</p>
                <p class="text-sm text-gray-400 mt-1">Need restocking</p>
              </div>
              
              <div class="bg-gray-800 rounded-lg p-6">
                <h3 class="text-lg font-semibold text-green-400 mb-2">Categories</h3>
                <p class="text-3xl font-bold text-white">{{ stats.totalCategories }}</p>
                <p class="text-sm text-gray-400 mt-1">Product categories</p>
              </div>
            </div>
            
            <!-- Recent Orders -->
            <div class="bg-gray-800 rounded-lg p-6">
              <h3 class="text-xl font-semibold text-green-400 mb-4">Recent Orders</h3>
              @if (stats.recentOrders.length > 0) {
                <div class="overflow-x-auto">
                  <table class="min-w-full">
                    <thead>
                      <tr class="border-b border-gray-700">
                        <th class="px-4 py-3 text-left text-sm font-medium text-gray-400">Order ID</th>
                        <th class="px-4 py-3 text-left text-sm font-medium text-gray-400">Customer</th>
                        <th class="px-4 py-3 text-left text-sm font-medium text-gray-400">Date</th>
                        <th class="px-4 py-3 text-left text-sm font-medium text-gray-400">Total</th>
                        <th class="px-4 py-3 text-left text-sm font-medium text-gray-400">Status</th>
                      </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-700">
                      @for (order of stats.recentOrders; track order.id) {
                        <tr class="hover:bg-gray-700">
                          <td class="px-4 py-4 text-sm text-white">#{{ order.id }}</td>
                          <td class="px-4 py-4 text-sm text-white">
                            {{ order.customer?.firstName }} {{ order.customer?.lastName }}
                          </td>
                          <td class="px-4 py-4 text-sm text-white">{{ formatDate(order.orderDate) }}</td>
                          <td class="px-4 py-4 text-sm text-white">{{ formatCurrency(order.totalAmount) }}</td>
                          <td class="px-4 py-4 text-sm">
                            <span class="px-2 py-1 rounded-full text-xs font-medium" [ngClass]="getOrderStatusClass(order.paymentStatus)">
                              {{ order.paymentStatus }}
                            </span>
                          </td>
                        </tr>
                      }
                    </tbody>
                  </table>
                </div>
              } @else {
                <p class="text-gray-400">No recent orders found.</p>
              }
            </div>
          }
        </div>
      }
      
      <!-- Products Section -->
      @if (activeSection === 'products') {
        <div>
          <div class="flex justify-between items-center mb-6">
            <h2 class="text-3xl font-bold text-white">Product Management</h2>
            <button 
              (click)="openProductModal()"
              class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md font-medium"
            >
              Add New Product
            </button>
          </div>
          
          <!-- Search and Filter -->
          <div class="bg-gray-800 rounded-lg p-4 mb-6">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-400 mb-1">Search Products</label>
                <input 
                  type="text" 
                  [(ngModel)]="productSearchTerm"
                  (input)="filterProducts()"
                  class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-green-500"
                  placeholder="Search by name or description..."
                >
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-400 mb-1">Filter by Category</label>
                <select 
                  [(ngModel)]="selectedCategoryFilter"
                  (change)="filterProducts()"
                  class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-green-500"
                >
                  <option value="">All Categories</option>
                  @for (category of categories; track category.id) {
                    <option [value]="category.id">{{ category.name }}</option>
                  }
                </select>
              </div>
              <div class="flex items-end">
                <button 
                  (click)="loadProducts()"
                  class="px-4 py-2 bg-gray-600 hover:bg-gray-500 text-white rounded-md"
                >
                  Refresh
                </button>
              </div>
            </div>
          </div>
          
          @if (isLoading) {
            <div class="flex justify-center items-center h-64">
              <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-green-500"></div>
            </div>
          }
          
          @if (!isLoading) {
            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <div class="overflow-x-auto">
                <table class="min-w-full">
                  <thead class="bg-gray-700">
                    <tr>
                      <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Product</th>
                      <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Category</th>
                      <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Price</th>
                      <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Stock</th>
                      <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Status</th>
                      <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Actions</th>
                    </tr>
                  </thead>
                  <tbody class="divide-y divide-gray-700">
                    @for (product of filteredProducts; track product.id) {
                      <tr class="hover:bg-gray-700">
                        <td class="px-6 py-4 whitespace-nowrap">
                          <div class="flex items-center">
                            <img 
                              [src]="product.imageUrl || '/placeholder.svg?height=40&width=40'" 
                              [alt]="product.name"
                              class="h-10 w-10 rounded-lg object-cover mr-4"
                            >
                            <div>
                              <div class="text-sm font-medium text-white">{{ product.name }}</div>
                              <div class="text-sm text-gray-400">{{ product.description | slice:0:50 }}...</div>
                            </div>
                          </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-white">
                          {{ getCategoryName(product.categoryId) }}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-white">
                          {{ formatCurrency(product.price) }}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-white">
                          {{ product.stock }}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                          <span class="px-2 py-1 rounded-full text-xs font-medium" [ngClass]="getStockStatusClass(product.stock)">
                            {{ getStockStatus(product.stock) }}
                          </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                          <button 
                            (click)="openProductModal(product)"
                            class="text-green-400 hover:text-green-300 mr-3"
                          >
                            Edit
                          </button>
                          <button 
                            (click)="deleteProduct(product)"
                            class="text-red-400 hover:text-red-300"
                          >
                            Delete
                          </button>
                        </td>
                      </tr>
                    } @empty {
                      <tr>
                        <td colspan="6" class="px-6 py-4 text-center text-gray-400">
                          No products found
                        </td>
                      </tr>
                    }
                  </tbody>
                </table>
              </div>
            </div>
          }
        </div>
      }
      
      <!-- Categories Section -->
      @if (activeSection === 'categories') {
        <div>
          <div class="flex justify-between items-center mb-6">
            <h2 class="text-3xl font-bold text-white">Category Management</h2>
            <button 
              (click)="openCategoryModal()"
              class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md font-medium"
            >
              Add New Category
            </button>
          </div>
          
          @if (isLoading) {
            <div class="flex justify-center items-center h-64">
              <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-green-500"></div>
            </div>
          }
          
          @if (!isLoading) {
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
              @for (category of categories; track category.id) {
                <div class="bg-gray-800 rounded-lg p-6">
                  <h3 class="text-xl font-semibold text-white mb-2">{{ category.name }}</h3>
                  <p class="text-gray-400 mb-4">{{ category.description || 'No description' }}</p>
                  <div class="flex justify-between items-center">
                    <span class="text-sm text-gray-500">
                      {{ getProductCountByCategory(category.id) }} products
                    </span>
                    <div class="space-x-2">
                      <button 
                        (click)="openCategoryModal(category)"
                        class="text-green-400 hover:text-green-300 text-sm"
                      >
                        Edit
                      </button>
                      <button 
                        (click)="deleteCategory(category)"
                        class="text-red-400 hover:text-red-300 text-sm"
                      >
                        Delete
                      </button>
                    </div>
                  </div>
                </div>
              } @empty {
                <div class="col-span-full text-center text-gray-400 py-12">
                  No categories found
                </div>
              }
            </div>
          }
        </div>
      }
      
      <!-- Orders Section -->
      @if (activeSection === 'orders') {
        <div>
          <div class="flex justify-between items-center mb-6">
            <h2 class="text-3xl font-bold text-white">Order Management</h2>
            <div class="flex space-x-2">
              <select 
                [(ngModel)]="orderStatusFilter"
                (change)="filterOrders()"
                class="px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-green-500"
              >
                <option value="">All Statuses</option>
                <option value="Pending">Pending</option>
                <option value="Completed">Completed</option>
                <option value="Failed">Failed</option>
              </select>
              <button 
                (click)="loadOrders()"
                class="px-4 py-2 bg-gray-600 hover:bg-gray-500 text-white rounded-md"
              >
                Refresh
              </button>
            </div>
          </div>
          
          @if (isLoading) {
            <div class="flex justify-center items-center h-64">
              <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-green-500"></div>
            </div>
          }
          
          @if (!isLoading) {
            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <div class="overflow-x-auto">
                <table class="min-w-full">
                  <thead class="bg-gray-700">
                    <tr>
                      <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Order ID</th>
                      <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Customer</th>
                      <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Date</th>
                      <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Total</th>
                      <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Status</th>
                      <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Actions</th>
                    </tr>
                  </thead>
                  <tbody class="divide-y divide-gray-700">
                    @for (order of filteredOrders; track order.id) {
                      <tr class="hover:bg-gray-700">
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-white">#{{ order.id }}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-white">
                          {{ order.customer?.firstName }} {{ order.customer?.lastName }}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-white">
                          {{ formatDate(order.orderDate) }}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-white">
                          {{ formatCurrency(order.totalAmount) }}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                          <select 
                            [value]="order.paymentStatus"
                            (change)="updateOrderStatus(order, order.paymentStatus)"
                            class="px-2 py-1 bg-gray-700 border border-gray-600 rounded text-white text-xs"
                          >
                            <option value="Pending">Pending</option>
                            <option value="Completed">Completed</option>
                            <option value="Failed">Failed</option>
                          </select>`
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                          <button 
                            (click)="viewOrderDetails(order)"
                            class="text-green-400 hover:text-green-300"
                          >
                            View Details
                          </button>
                        </td>
                      </tr>
                    } @empty {
                      <tr>
                        <td colspan="6" class="px-6 py-4 text-center text-gray-400">
                          No orders found
                        </td>
                      </tr>
                    }
                  </tbody>
                </table>
              </div>
            </div>
          }
        </div>
      }
      
      <!-- Customers Section -->
      @if (activeSection === 'customers') {
        <div>
          <div class="flex justify-between items-center mb-6">
            <h2 class="text-3xl font-bold text-white">Customer Management</h2>
            <div class="flex space-x-2">
              <input 
                type="text" 
                [(ngModel)]="customerSearchTerm"
                (input)="filterCustomers()"
                class="px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-green-500"
                placeholder="Search customers..."
              >
              <button 
                (click)="loadCustomers()"
                class="px-4 py-2 bg-gray-600 hover:bg-gray-500 text-white rounded-md"
              >
                Refresh
              </button>
            </div>
          </div>
          
          @if (isLoading) {
            <div class="flex justify-center items-center h-64">
              <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-green-500"></div>
            </div>
          }
          
          @if (!isLoading) {
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
              @for (customer of filteredCustomers; track customer.userId) {
                <div class="bg-gray-800 rounded-lg p-6">
                  <div class="flex items-center mb-4">
                    <div class="w-12 h-12 bg-green-500 rounded-full flex items-center justify-center text-white font-bold mr-4">
                      {{ customer.firstName.charAt(0) }}{{ customer.lastName.charAt(0) }}
                    </div>
                    <div>
                      <h3 class="text-lg font-semibold text-white">{{ customer.firstName }} {{ customer.lastName }}</h3>
                      <p class="text-gray-400 text-sm">{{ customer.user?.email }}</p>
                    </div>
                  </div>
                  <div class="space-y-2 text-sm">
                    <p class="text-gray-400">Phone: {{ customer.phoneNumber || 'Not provided' }}</p>
                    <p class="text-gray-400">Address: {{ customer.address || 'Not provided' }}</p>
                  </div>
                  <div class="mt-4">
                    <button 
                      (click)="viewCustomerDetails(customer)"
                      class="text-green-400 hover:text-green-300 text-sm"
                    >
                      View Details
                    </button>
                  </div>
                </div>
              } @empty {
                <div class="col-span-full text-center text-gray-400 py-12">
                  No customers found
                </div>
              }
            </div>
          }
        </div>
      }
      
      <!-- Users Section -->
      @if (activeSection === 'users') {
        <div>
          <div class="flex justify-between items-center mb-6">
            <h2 class="text-3xl font-bold text-white">User Management</h2>
            <div class="flex space-x-2">
              <select 
                [(ngModel)]="userRoleFilter"
                (change)="filterUsers()"
                class="px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-green-500"
              >
                <option value="">All Roles</option>
                <option value="Customer">Customer</option>
                <option value="Admin">Admin</option>
              </select>
              <button 
                (click)="openUserModal()"
                class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md font-medium"
              >
                Add New User
              </button>
            </div>
          </div>
          
          @if (isLoading) {
            <div class="flex justify-center items-center h-64">
              <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-green-500"></div>
            </div>
          }
          
          @if (!isLoading) {
            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <div class="overflow-x-auto">
                <table class="min-w-full">
                  <thead class="bg-gray-700">
                    <tr>
                      <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">User</th>
                      <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Email</th>
                      <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Role</th>
                      <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Actions</th>
                    </tr>
                  </thead>
                  <tbody class="divide-y divide-gray-700">
                    @for (user of filteredUsers; track user.id) {
                      <tr class="hover:bg-gray-700">
                        <td class="px-6 py-4 whitespace-nowrap">
                          <div class="flex items-center">
                            <div class="w-10 h-10 bg-green-500 rounded-full flex items-center justify-center text-white font-bold mr-4">
                              {{ user.username.charAt(0).toUpperCase() }}
                            </div>
                            <div>
                              <div class="text-sm font-medium text-white">{{ user.username }}</div>
                              <div class="text-sm text-gray-400">ID: {{ user.id }}</div>
                            </div>
                          </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-white">
                          {{ user.email }}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                          <select 
                            [value]="user.role"
                            (change)="updateUserRole(user,'Customer')"
                            class="px-2 py-1 bg-gray-700 border border-gray-600 rounded text-white text-xs"
                          >
                            <option value="Customer">Customer</option>
                            <option value="Admin">Admin</option>
                          </select>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                          <button 
                            (click)="openUserModal(user)"
                            class="text-green-400 hover:text-green-300"
                          >
                            Edit
                          </button>
                        </td>
                      </tr>
                    } @empty {
                      <tr>
                        <td colspan="4" class="px-6 py-4 text-center text-gray-400">
                          No users found
                        </td>
                      </tr>
                    }
                  </tbody>
                </table>
              </div>
            </div>
          }
        </div>
      }
    </main>
  </div>

  <!-- Product Modal -->
  @if (showProductModal) {
    <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
      <div class="bg-gray-800 rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
        <div class="p-6">
          <div class="flex justify-between items-center mb-6">
            <h2 class="text-xl font-semibold text-green-400">
              {{ editingProduct ? 'Edit Product' : 'Add New Product' }}
            </h2>
            <button 
              (click)="closeProductModal()"
              class="text-gray-400 hover:text-white"
            >
              &times;
            </button>
          </div>
          
          <form [formGroup]="productForm" (ngSubmit)="onProductSubmit()">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
              <div>
                <label class="block text-sm font-medium text-gray-400 mb-1">Product Name *</label>
                <input 
                  type="text" 
                  formControlName="name"
                  class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-green-500"
                >
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-400 mb-1">Category *</label>
                <select 
                  formControlName="categoryId"
                  class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-green-500"
                >
                  <option value="">Select Category</option>
                  @for (category of categories; track category.id) {
                    <option [value]="category.id">{{ category.name }}</option>
                  }
                </select>
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-400 mb-1">Price *</label>
                <input 
                  type="number" 
                  step="0.01"
                  formControlName="price"
                  class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-green-500"
                >
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-400 mb-1">Stock *</label>
                <input 
                  type="number" 
                  formControlName="stock"
                  class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-green-500"
                >
              </div>
              
              <div class="md:col-span-2">
                <label class="block text-sm font-medium text-gray-400 mb-1">Image URL</label>
                <input 
                  type="url" 
                  formControlName="imageUrl"
                  class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-green-500"
                >
              </div>
              
              <div class="md:col-span-2">
                <label class="block text-sm font-medium text-gray-400 mb-1">Description</label>
                <textarea 
                  formControlName="description"
                  rows="3"
                  class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-green-500"
                ></textarea>
              </div>
            </div>
            
            <div class="flex justify-end space-x-3">
              <button 
                type="button"
                (click)="closeProductModal()"
                class="px-4 py-2 bg-gray-600 hover:bg-gray-500 text-white rounded-md"
              >
                Cancel
              </button>
              <button 
                type="submit"
                [disabled]="productForm.invalid || isSubmitting"
                class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-md disabled:opacity-50"
              >
                {{ isSubmitting ? 'Saving...' : (editingProduct ? 'Update' : 'Create') }}
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  }

  <!-- Category Modal -->
  @if (showCategoryModal) {
    <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
      <div class="bg-gray-800 rounded-lg shadow-xl max-w-md w-full">
        <div class="p-6">
          <div class="flex justify-between items-center mb-6">
            <h2 class="text-xl font-semibold text-green-400">
              {{ editingCategory ? 'Edit Category' : 'Add New Category' }}
            </h2>
            <button 
              (click)="closeCategoryModal()"
              class="text-gray-400 hover:text-white"
            >
              &times;
            </button>
          </div>
          
          <form [formGroup]="categoryForm" (ngSubmit)="onCategorySubmit()">
            <div class="space-y-4">
              <div>
                <label class="block text-sm font-medium text-gray-400 mb-1">Category Name *</label>
                <input 
                  type="text" 
                  formControlName="name"
                  class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-green-500"
                >
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-400 mb-1">Description</label>
                <textarea 
                  formControlName="description"
                  rows="3"
                  class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-green-500"
                ></textarea>
              </div>
            </div>
            
            <div class="flex justify-end space-x-3 mt-6">
              <button 
                type="button"
                (click)="closeCategoryModal()"
                class="px-4 py-2 bg-gray-600 hover:bg-gray-500 text-white rounded-md"
              >
                Cancel
              </button>
              <button 
                type="submit"
                [disabled]="categoryForm.invalid || isSubmitting"
                class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-md disabled:opacity-50"
              >
                {{ isSubmitting ? 'Saving...' : (editingCategory ? 'Update' : 'Create') }}
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  }

  <!-- Order Details Modal -->
  @if (showOrderModal && selectedOrder) {
    <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
      <div class="bg-gray-800 rounded-lg shadow-xl max-w-3xl w-full max-h-[90vh] overflow-y-auto">
        <div class="p-6">
          <div class="flex justify-between items-center mb-6">
            <h2 class="text-xl font-semibold text-green-400">Order #{{ selectedOrder.id }}</h2>
            <button 
              (click)="closeOrderModal()"
              class="text-gray-400 hover:text-white"
            >
              &times;
            </button>
          </div>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
            <div>
              <h3 class="text-sm font-medium text-gray-400 mb-2">Order Information</h3>
              <p class="text-white">Date: {{ formatDate(selectedOrder.orderDate) }}</p>
              <p class="text-white">Total: {{ formatCurrency(selectedOrder.totalAmount) }}</p>
              <p class="text-white">Status: 
                <span class="px-2 py-1 rounded-full text-xs font-medium" [ngClass]="getOrderStatusClass(selectedOrder.paymentStatus)">
                  {{ selectedOrder.paymentStatus }}
                </span>
              </p>
            </div>
            
            <div>
              <h3 class="text-sm font-medium text-gray-400 mb-2">Customer Information</h3>
              <p class="text-white">{{ selectedOrder.customer?.firstName }} {{ selectedOrder.customer?.lastName }}</p>
              <p class="text-white">{{ selectedOrder.customer?.user?.email }}</p>
              <p class="text-white">{{ selectedOrder.customer?.phoneNumber }}</p>
              <p class="text-white">{{ selectedOrder.customer?.address }}</p>
            </div>
          </div>
          
          <div class="mt-6">
            <h3 class="text-sm font-medium text-gray-400 mb-2">Update Status</h3>
            <select 
              [value]="selectedOrder.paymentStatus"
              (change)="updateOrderStatus(selectedOrder, 'Pending')"
              class="px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-green-500"
            >
              <option value="Pending">Pending</option>
              <option value="Completed">Completed</option>
              <option value="Failed">Failed</option>
            </select>
          </div>
        </div>
      </div>
    </div>
  }

  <!-- Customer Details Modal -->
  @if (showCustomerModal && selectedCustomer) {
    <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
      <div class="bg-gray-800 rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
        <div class="p-6">
          <div class="flex justify-between items-center mb-6">
            <h2 class="text-xl font-semibold text-green-400">Customer Details</h2>
            <button 
              (click)="closeCustomerModal()"
              class="text-gray-400 hover:text-white"
            >
              &times;
            </button>
          </div>
          
          <div class="flex items-center mb-6">
            <div class="w-16 h-16 bg-green-500 rounded-full flex items-center justify-center text-white text-xl font-bold mr-4">
              {{ selectedCustomer.firstName.charAt(0) }}{{ selectedCustomer.lastName.charAt(0) }}
            </div>
            <div>
              <h3 class="text-xl font-semibold text-white">{{ selectedCustomer.firstName }} {{ selectedCustomer.lastName }}</h3>
              <p class="text-gray-400">{{ selectedCustomer.user?.email }}</p>
            </div>
          </div>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <h3 class="text-sm font-medium text-gray-400 mb-2">Contact Information</h3>
              <p class="text-white">Email: {{ selectedCustomer.user?.email }}</p>
              <p class="text-white">Phone: {{ selectedCustomer.phoneNumber || 'Not provided' }}</p>
              <p class="text-white">Address: {{ selectedCustomer.address || 'Not provided' }}</p>
            </div>
            
            <div>
              <h3 class="text-sm font-medium text-gray-400 mb-2">Account Information</h3>
              <p class="text-white">User ID: {{ selectedCustomer.userId }}</p>
              <p class="text-white">Username: {{ selectedCustomer.user?.username }}</p>
              <p class="text-white">Role: {{ selectedCustomer.user?.role }}</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  }

  <!-- User Modal -->
  @if (showUserModal) {
    <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
      <div class="bg-gray-800 rounded-lg shadow-xl max-w-md w-full">
        <div class="p-6">
          <div class="flex justify-between items-center mb-6">
            <h2 class="text-xl font-semibold text-green-400">
              {{ editingUser ? 'Edit User' : 'Add New User' }}
            </h2>
            <button 
              (click)="closeUserModal()"
              class="text-gray-400 hover:text-white"
            >
              &times;
            </button>
          </div>

          <form [formGroup]="userForm" (ngSubmit)="onUserSubmit()">
            <div class="space-y-4">
              <div>
                <label class="block text-sm font-medium text-gray-400 mb-1">Username *</label>
                <input 
                  type="text" 
                  formControlName="username"
                  class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-green-500"
                >
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-400 mb-1">Email *</label>
                <input 
                  type="email" 
                  formControlName="email"
                  class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-green-500"
                >
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-400 mb-1">Role *</label>
                <select 
                  formControlName="role"
                  class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-green-500"
                >
                  <option value="Customer">Customer</option>
                  <option value="Admin">Admin</option>
                </select>
              </div>
            </div>
            
            <div class="flex justify-end space-x-3 mt-6">
              <button 
                type="button"
                (click)="closeUserModal()"
                class="px-4 py-2 bg-gray-600 hover:bg-gray-500 text-white rounded-md"
              >
                Cancel
              </button>
              <button 
                type="submit"
                [disabled]="userForm.invalid || isSubmitting"
                class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-md disabled:opacity-50"
              >
                {{ isSubmitting ? 'Saving...' : (editingUser ? 'Update' : 'Create') }}
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  }
</div>
